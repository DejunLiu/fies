#!/bin/bash
if [ "$#" -ne 1 ]
then
	echo "Usage : ./startTests.sh <path-to-kernel-and-fault-library-config-files >"
exit 1
fi
DATA_COLLECTOR_PATH="data_collector.txt"
CONFIG_FILE=$1
counter=1
while read line
do
	
	KERNEL_PATH=$(echo "$line\n" | cut -f1 -d,)
	FAULT_LIBRARY_PATH=$(echo "$line\n" | cut -f2 -d,)
	echo Kernel_Path:$KERNEL_PATH
	echo Fault_Lib_P:$FAULT_LIBRARY_PATH

	FAULT_COUNTER_ADDRESS=$(readelf $KERNELPATH -s | grep fault_counter)
	echo "FAULT_COUNTER_ADDRESS: $FAULT_COUNTER_ADDRESS"
	FAULT_COUNTER_ADDRESS=$(echo $FAULT_COUNTER_ADDRESS | cut -f2 -d :)
	echo "FAULT_COUNTER_ADDRESS: $FAULT_COUNTER_ADDRESS"
	FAULT_COUNTER_ADDRESS=$(echo $FAULT_COUNTER_ADDRESS | cut -f1 -d ' ')
	echo "FAULT_COUNTER_ADDRESS: $FAULT_COUNTER_ADDRESS"

	counter=$((counter+1))
done < $1
echo "Fault injection experiment finished"


